---
title: "Coursera - Machine Learning - Final Project"
author: "Arunabh Singh"
date: "3/20/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

```{r cars}
setwd("~/Desktop/Work/Training/Coursera/Machine Learning/Project")
testdata = read.csv(file = "pml-testing.csv")
trainingdata = read.csv(file = "pml-training.csv")

library(caret)

colnames(trainingdata)
#summary(trainingdata)

# Cross validation
# Use 70% of training set data to built a model, and use the rest to test the model

## Loading required package: lattice
## Loading required package: ggplot2

set.seed(1111)
train <- createDataPartition(y=trainingdata$classe,p=.70,list=F)
training <- trainingdata[train,]
testing <- trainingdata[-train,]

#Cleaning the training data

#exclude identifier, timestamp, and window data (they cannot be used for prediction)
Cl <- grep("name|timestamp|window|X", colnames(training), value=F) 
trainingCl <- training[,-Cl]
#select variables with high (over 95%) missing data --> exclude them from the analysis
trainingCl[trainingCl==""] <- NA
NArate <- apply(trainingCl, 2, function(x) sum(is.na(x)))/nrow(trainingCl)
trainingCl <- trainingCl[!(NArate>0.95)]
summary(trainingCl)

#PCA
#Since the number of variables are still over 50, PCA is applied

preProc <- preProcess(trainingCl[,1:52],method="pca",thresh=.8) #12 components are required
preProc <- preProcess(trainingCl[,1:52],method="pca",thresh=.9) #18 components are required
preProc <- preProcess(trainingCl[,1:52],method="pca",thresh=.95) #25 components are required

preProc <- preProcess(trainingCl[,1:52],method="pca",pcaComp=25) 
#preProc$rotation
trainingPC <- predict(preProc,trainingCl[,1:52])

# Random forest
# Apply ramdom forest method (non-bionominal outcome & large sample size)

library(randomForest)

modFitRF <- randomForest(trainingCl$classe ~ .,   data=trainingPC, do.trace=F)
print(modFitRF) # view results 

# Check with test set

testingCl <- testing[,-Cl]
testingCl[testingCl==""] <- NA
NArate <- apply(testingCl, 2, function(x) sum(is.na(x)))/nrow(testingCl)
testingCl <- testingCl[!(NArate>0.95)]
testingPC <- predict(preProc,testingCl[,1:52])
confusionMatrix(testingCl$classe,predict(modFitRF,testingPC))

#Predict the test cases
testdataCl <- testdata[,-Cl]
testdataCl[testdataCl==""] <- NA
NArate <- apply(testdataCl, 2, function(x) sum(is.na(x)))/nrow(testdataCl)
testdataCl <- testdataCl[!(NArate>0.95)]
testdataPC <- predict(preProc,testdataCl[,1:52])
testdataCl$classe <- predict(modFitRF,testdataPC)
#All 20 predicted answers were correct according to the grader on Coursera
```

## Summary

In this analyses, 19622 observations from weight lifting exercise were used to analyze and predict correct body movement from others. 70% of the total observations (13737 observations) were used to build a model by random forest method, and the rest of 30% of the observations (5885 observations) were used for model validation (cross-validation). 70:30 is a pretty standard data split for training/cross-validation.

Technically, some other things were done:

1) Getting rid of variables because they had NAs/NULL values

2) The number of variables was still quite large, so Principal Component Analysis (PCA) was done to reduce the number of variables further

3) The variable to be predicted ("classe"), was converted to a factor variable

4) Random Forest was used as the method because it is well-suited for a large number of variables, especially in case of predicting an outcome which is a factor.

The model statistics showed that the built model had the overall accuracy of 97% for the testing set, which is not overlapping with observations used to built the model. The sensitivity was in between 92%-99% and the specificity was around 99% for all classes (class A-E, total 5 classes. class A is the data from correct exercise while the other classes were data from exercises done in a wrong way).

Overall, the model is well developed to predict the exercise classes during weight lifting. As for the limitation in this study, the observation data used in the analyses was collected from 6 young health participants in an experiment using Microsoft Kinect. Therefore, under those condition, the model is expected to perform over 95% accuracy; however, with different conditions, such as experiments with elderly people and/or using different device, the model might not perform well as shown in the analysis.
